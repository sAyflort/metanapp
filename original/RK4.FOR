
      SUBROUTINE VISCOS(N1,N2,N3,A)
      DIMENSION A(N1,N2,N3)
      COMMON/CW/  AE(46,22),AW(46,22),AN(46,22),AS(46,22),
     *BE(46),BW(46),BN(22),BS(22),VS(46,22),FKS(46,22),TKS(46,22),
     *AE1(46,22),AW1(46,22),AN1(46,22),AS1(46,22),UKS(46,22),PK(46,22)
      COMMON/CNUMBR/NW,NF,NMFU1,NMOX2,NMFU2,NMOX1,NMPR1,NMPR2,NMDF,
     * NRO3,NRO1,NK,NT,NV1,NV2,NDFU1,NMU,NNFU1,
     * NRFU1,NMFU3,NMOX3,NMU1,NMU2,IE,IV
      COMMON/CGED/IN,INM,JN,JNM,IMIN(22),IMAX(22),X1(46),X2(22),R(22),
     *NCORD,LN,LMIN(25),VINT,ROT,VINP1,VINS1,VINT1,ROS1,ROP1
      COMMON/CGEN/D,P,H,NMAX,NPRINT,IP,CC,RSDU(12),C
      COMMON/CVLT/JA,JB,JC,IC,VINP,VINS,ROP,ROS,ZMF2N,ZMO2N,
     *ZNF2N,ROM1,AMS,AMO,AMG
      COMMON/CVLE/RO1,JZ,JZ1,NVAR,NVARM,AFI,AFIG
      COMMON/CVNT/NITER,RL,IC2,JA1,JB1,JC1,IC1,JA2,JA3
      COMMON/XL/ PKS(46),AKT
      RL=0.1
      DO 100 K=3,9
      DO 100 J=1,JN
      IL=IMIN(J)
      IM=IMAX(J)+1
      IF(J.LT.JA1.AND.J.GT.JA) IL=IMIN(J)-1
      IF(J.LT.JZ1.AND.J.GT.JZ) IL=IMIN(J)-1
      IF(J.GT.JA2) IL=IMIN(J)-1
      DO 100 I=IL,IM
      IF(A(I,J,K).LT.0.) A(I,J,K)=0.
  100 CONTINUE
      DO 121 J=1,JN
      IL=IMIN(J)
      IM=IMAX(J)+1
      IF(J.LE.JC) IM=IN
      IF(J.LT.JA1.AND.J.GT.JA) IL=IMIN(J)-1
      IF(J.LT.JZ1.AND.J.GT.JZ) IL=IMIN(J)-1
      IF(J.GT.JA2) IL=IMIN(J)-1
      DO 121 I=IL,IM
      CM=A(I,J,NMFU1)+A(I,J,NMFU2)+A(I,J,NMOX1)+A(I,J,NMOX2)+
     *A(I,J,NMPR1)+A(I,J,NMPR2)+A(I,J,NMDF)
      IF(CM.LE.0.) GO TO 121
      A(I,J,NMFU1)=A(I,J,NMFU1)/CM
      A(I,J,NMFU2)=A(I,J,NMFU2)/CM
      A(I,J,NMOX1)=A(I,J,NMOX1)/CM
      A(I,J,NMOX2)=A(I,J,NMOX2)/CM
      A(I,J,NMPR1)=A(I,J,NMPR1)/CM
      A(I,J,NMPR2)=A(I,J,NMPR2)/CM
      A(I,J,NMDF)=A(I,J,NMDF)/CM
  121 CONTINUE
      DO  20 J=1,JN
      IL=IMIN(J)
      IM=IMAX(J)+1
      IF(J.LE.JC) IM=IN
      IF(J.LT.JA1.AND.J.GT.JA) IL=IMIN(J)-1
      IF(J.LT.JZ1.AND.J.GT.JZ) IL=IMIN(J)-1
      IF(J.GT.JA2) IL=IMIN(J)-1
      DO  20 I=IL,IM
      AZK=A(I,J,NMPR1)+A(I,J,NMOX2)+A(I,J,NMDF)+A(I,J,NMPR2)+
     *A(I,J,NMFU2)
      ZOKD=AZK*0.7966+A(I,J,NMOX1)
      ZGD=AZK*0.2034+A(I,J,NMFU1)
      IF(ZGD.LT.0.005) ZGD=0.005
      XXX=ZOKD/ZGD/3.9166
      IF(XXX.GT.0.8) GO TO 1
      AA=0.02323446
      BA=5968.083
      CA=9185.521
      DA=-24199.95
      EA=12664.67
    1 CONTINUE
      IF(XXX.LE.0.8) GO TO 5
      IF(A(I,J,NK).GT.2) GO TO 2
      AA=-0.3167559
      BA=10790.7
      CA=-11990.44
      DA=5632.969
      EA=-969.617
    2 CONTINUE
      IF(XXX.LE.2.) GO TO 5
      AA=-1.954687
      BA=4416.632
      CA=-2128.663
      DA=412.6477
      EA=-29.03693
    5 CONTINUE
      YYY=AA+BA*XXX+CA*XXX**2+DA*XXX**3.+EA*XXX**4.
      IF(YYY.LT.293.) YYY=293.
    6 CONTINUE
      Z=A(I,J,NT)
      CK=0.3868
      CG=3.332  
      TQ=3.332*A(I,J,NMFU1)+14.743*A(I,J,NMDF)+
     *1.081*A(I,J,NMPR1)+0.3868*A(I,J,NMOX1)+2.059*A(I,J,NMPR2)+
     *1.105*A(I,J,NMOX2)+1.753*A(I,J,NMFU2)
      TZ=A(I,J,NMU1)+4681.06*A(I,J,NMFU1)-A(I,J,NMFU2)*2299.57+
     * A(I,J,NMOX2)*3949.64+8950.*A(I,J,NMPR1)+13445.55*A(I,J,NMPR2)
      IF(TZ.LT.0.) TZ=0.
      IF(TQ.LE.1.E-10) GO TO 50 
      A(I,J,NT)=TZ/TQ+293.
      IF(XXX.GT.0.8) A(I,J,NT)=A(I,J,NT)*1.1
      IF(XXX.GE.0.2.AND.XXX.LE.0.8) A(I,J,NT)=A(I,J,NT)*1.2
   50 CONTINUE
      IF(A(I,J,NT).LT.293.) A(I,J,NT)=293.
      IF(A(I,J,NT).GT.4500.) A(I,J,NT)=4500.
      DY1=A(I,J,NT)-YYY
      DYY=(A(I,J,NT)-YYY)/A(I,J,NT)
C      IF(NITER.EQ.NMAX) PRINT *,I,J,XXX,A(I,J,NT),YYY,DYY,DY1
      Z=A(I,J,NRO3)
      ROQ=A(I,J,NT)*(A(I,J,NMFU1)/16.+A(I,J,NMOX1)/32.+A(I,J,NMDF)/2.
     * +A(I,J,NMOX2)/28.+A(I,J,NMPR1)/44.+A(I,J,NMPR2)/18.+
     * A(I,J,NMFU2)/17.)
      IF(ROQ.EQ.0.) GO TO 60
      ROZ=A(I,J,NMOX1)+A(I,J,NMOX2)+A(I,J,NMDF)+A(I,J,NMFU1)+
     *A(I,J,NMPR1)+A(I,J,NMPR2)+A(I,J,NMFU2)
      ROX=PKS(I)/8314.4
      A(I,J,NRO3)=ROX*ROZ/ROQ
      A(I,J,NRO3)=Z+(A(I,J,NRO3)-Z)*RL
   60 CONTINUE
      IF(A(I,J,NRO3).LT.0.00001) A(I,J,NRO3)=0.00001
   20 CONTINUE
      RK4=0.
      DO 23 J=2,JA3
      RK4=RK4+3.1416*(A(IC2,J,NF)-A(IC2,J-1,NF))*
     *(A(IC2,J,NV1)**2+A(IC2,J,NMU2)**2)
   23 CONTINUE
      DO 21 J=1,JN
      IL=IMIN(J)
      IM=IMAX(J)+1
      IF(J.EQ.JC) IM=IN
      DO 21 I=IL,IM
      VK1=(VINP**2+((A(1,JA,NMU2)/R(JA-1))**2))**0.5
      RZ1=(2.*R(JN))**0.666/(X1(IC1))**0.333
      IF(I.LE.IC2) RZ1=(2*R(JA3))**0.666/(X1(IC1))**0.333
      RK= 3.1416*(R(JA2)**2.-R(JA1)**2.)*ROS*VINS**3.
      RK1=3.1416*(R(JA)-R(JZ1))*(R(JA)+R(JZ1))*ROP*VINP*VINP**2+
     * 3.1416*R(JZ)**2.*A(1,2,NRO3)*VINS1**3.
      IF(I.GT.IC2) RK2=RK+RK4
      IF(I.LE.IC2) RK2=RK1
      A(I,J,NMU)=0.012*RZ1*A(I,J,NRO3)**0.666*RK2**0.333
      A(I,J,NMU)=A(I,J,NMU)*2. 
  21  CONTINUE
      RETURN
      END
